<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Course Buddy: Phantom Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=Urbanist:ital,wght@0,400;0,700;0,900;1,900&display=swap" rel="stylesheet">
    <!-- Lucide Icons Styling -->
    <style>
        body { background-color: #0f172a; } /* Prevent white flash */
        /* Hide scrollbar */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animations */
        .animate-spin-slow { animation: spin 15s linear infinite; }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        .diagonal-lines { background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.1) 5px, rgba(0,0,0,0.1) 10px); }
        
        /* P5 Chat Background Pattern */
        .p5-chat-bg {
            background-color: #DC2626; /* Red-600 */
            background-image: 
                linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000),
                linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            opacity: 0.9;
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pop { 0% { transform: scale(0.9); } 100% { transform: scale(1); } }
        
        /* Custom P5 Style Checkbox */
        .p5-checkbox:checked + div {
            background-color: #FACC15; /* Yellow */
            border-color: #000;
        }
    </style>
    
    <!-- Import Map for React & Lucide -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from "react";
        import { createRoot } from "react-dom/client";
        import {
          BookOpen, Users, User, Search, Bell, Filter, Plus, ChevronLeft, Send,
          Clock, Target, MapPin, FileText, ChevronRight, Play, Pause, Settings,
          CheckSquare, Zap, ArrowRight, MessageCircle, Star, X, Calendar, Check,
          AlertCircle, Download, Sparkles, Loader2, Brain, Music, Volume2, Heart,
          BarChart2, SkipForward, SkipBack, RefreshCw, LogOut, Shield, Smartphone,
          Sun, CloudRain, Cloud, Wind, AlertTriangle, CornerDownLeft, 
          ThumbsUp, Camera, Scroll, Sword, ShoppingBag, Coffee, Video, Stamp,
          Fingerprint, Radio, Mail, Compass, MessageSquare, Home, Eye, Map as MapIcon,
          Trophy, Crown, Zap as ZapIcon, Folder
        } from "lucide-react";

        const apiKey = ""; // API Key placeholder

        // --- Data ---
        const CURRENT_USER = {
          id: "u1", name: "SCHOLAR", school: "ÁßÄÂ∞ΩÂ≠¶Èô¢ ¬∑ Êï∞Â™íÁ≥ª",
          avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",
          tags: ["ËÄÉÁ†îÂÖö", "Âõæ‰π¶È¶ÜÈíâÂ≠êÊà∑", "Ê±ÇËøá"],
          stats: { focusTime: 1240, tasks: 15, reliability: 98 }, verified: true,
        };

        const COURSES = [
          { id: "c1", name: "‰∫§‰∫íËÆæËÆ°ÂéüÁêÜ", time: "08:00", location: "ËÆæËÆ°Ê•º A301", day: "MON", theme: "bg-black text-white" },
          { id: "c2", name: "WebÂâçÁ´ØÂºÄÂèë", time: "10:00", location: "ËÆ°ÁÆó‰∏≠ÂøÉ 204", day: "TUE", theme: "bg-white text-black" },
          { id: "c3", name: "È´òÁ≠âÊï∞Â≠¶(‰∏ã)", time: "14:00", location: "‰∏ÄÊïô 101", day: "WED", theme: "bg-blue-600 text-white" },
          { id: "c4", name: "Â§ßÂ≠¶Ëã±ËØ≠(IV)", time: "08:00", location: "Â§ñËØ≠Ê•º 305", day: "THU", theme: "bg-yellow-400 text-black" },
        ];

        const NOTIFICATIONS = [
          { id: 1, type: "system", title: "MISSION START", content: "Â≠¶ÁîüË∫´‰ªΩËÆ§ËØÅÈÄöËøá„ÄÇ", time: "2Â∞èÊó∂Ââç", read: false },
          { id: 2, type: "invite", title: "INVITATION", content: "ÊùéÊÉ≥ÈÇÄËØ∑‰Ω†Âä†ÂÖ•‚ÄúÂâçÁ´ØÂºÄÂèëÊúüÊú´È°πÁõÆÁªÑ‚Äù„ÄÇ", time: "1Â§©Ââç", read: true },
          { id: 3, type: "alert", title: "DEADLINE", content: "„Ää‰∫§‰∫íËÆæËÆ°„Äã‰Ωú‰∏öÈúÄÂú®ÊòéÊó•Êèê‰∫§„ÄÇ", time: "3Â§©Ââç", read: true },
        ];

        const CHATS = [
          { id: "chat1", userId: "b1", name: "SKULL", major: "ËÆ°ÁÆóÊú∫", interests: "React, Ê∏∏Êàè", lastMsg: "ËÆ©ÊàëÁöÑ Persona Â§ßÊòæË∫´ÊâãÂêßÔºÅ", time: "10:24", unread: 2, avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka", rank: 7, arcana: "CHARIOT" },
          { id: "chat2", userId: "b2", name: "FOX", major: "ÁæéÊúØ", interests: "Á¥†Êèè, Â±ïËßà", lastMsg: "ÊòéÂ§©Âõæ‰π¶È¶ÜËßÅÔºÅ", time: "Êò®Â§©", unread: 0, avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Baby", rank: 4, arcana: "EMPEROR" },
        ];
        
        const MOCK_MESSAGES = {
          "chat1": [
            { id: 1, sender: "them", text: "Yo! ‰ªäÂ§©ÁöÑËØæ‰Ω†Âéª‰∫ÜÂêóÔºü", time: "10:20" },
            { id: 2, sender: "me", text: "Âéª‰∫ÜÔºåËÄÅÂ∏àËÆ≤‰∫ÜÊúüÊú´È°πÁõÆÁöÑË¶ÅÊ±Ç„ÄÇ", time: "10:21" },
            { id: 3, sender: "them", text: "ÁúüÂÅáÔºüÔºÅÈöæÂêóÔºü", time: "10:21" },
            { id: 4, sender: "them", text: "Êàë‰ª¨ÈúÄË¶ÅËµ∂Á¥ßÁªÑÈòü‰∫ÜÔºÅ", time: "10:22" },
            { id: 5, sender: "me", text: "ÊîæÂøÉÔºåÊàëÂ∑≤ÁªèÈ¢ÑÁïô‰∫Ü‰Ω†ÁöÑ‰ΩçÁΩÆ„ÄÇ‰Ω†Ë¥üË¥£ÂêéÁ´ØÔºü", time: "10:23" },
            { id: 6, sender: "them", text: "Ê≤°ÈóÆÈ¢òÔºÅËÆ©ÊàëÁöÑ Persona Â§ßÊòæË∫´ÊâãÂêßÔºÅ", time: "10:24" },
          ],
          "chat2": [
            { id: 1, sender: "them", text: "ÁîªÂ±ïÁöÑÁ•®Êàë‰π∞Âà∞‰∫Ü„ÄÇ", time: "Yesterday" },
            { id: 2, sender: "me", text: "Â§™Ê£í‰∫ÜÔºÅÂë®ÂÖ≠ËßÅÔºü", time: "Yesterday" },
          ]
        };
        
        const BUDDY_RECOMMENDATIONS = [
          { id: "b1", name: "MORGANA", major: "ËÆ°ÁÆóÊú∫ÁßëÂ≠¶", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka", matchScore: 99, commonCourses: ["WebÂâçÁ´Ø", "È´òÊï∞"], category: "ÂºÄÂèë", style: "ACADEMIC", desc: "ReactÁÜüÊâãÔºåÊ±ÇÈù†Ë∞±ÈòüÂèãÔºÅ", isOnline: true, rank: 2, arcana: "MAGICIAN" },
          { id: "b2", name: "PANTHER", major: "Êï∞Â≠óÂ™í‰Ωì", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Baby", matchScore: 85, commonCourses: ["‰∫§‰∫íËÆæËÆ°"], category: "ËÆæËÆ°", style: "SOCIAL", desc: "Ê≠£Âú®ÂÅöÁî®Êà∑Ë∞ÉÁ†îÔºåÊ±ÇÊê≠Â≠ê‰∏ÄËµ∑ÂéªÈ£üÂ†ÇÈááËÆø„ÄÇ", isOnline: false, rank: 5, arcana: "LOVERS" },
          { id: "b3", name: "FOX", major: "Êï∞Â≠¶Á≥ª", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Caleb", matchScore: 92, commonCourses: ["È´òÊï∞"], category: "È´òÊï∞", style: "SILENT", desc: "ÂçïÁ∫ØÊÉ≥Êâæ‰∏™‰∫∫Âú®Âõæ‰π¶È¶ÜÂØπÈù¢ÂùêÁùÄÔºå‰∏çËØ¥ËØù„ÄÇ", isOnline: true, rank: 1, arcana: "EMPEROR" },
          { id: "b4", name: "QUEEN", major: "Ê≥ïÂæãÁ≥ª", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Jocelyn", matchScore: 80, commonCourses: [], category: "Ëá™‰π†", style: "STRICT", desc: "ËÄÉÂÖ¨Â§ç‰π†‰∏≠ÔºåËøüÂà∞‰∏ÄÊ¨°Â•ëÁ∫¶ÁªàÊ≠¢„ÄÇ", isOnline: false, rank: 0, arcana: "PRIESTESS" },
        ];

        const GROUPS = [
          { 
            id: "g1", title: "ÂâçÁ´ØÂºÄÂèëÂ∞èÁªÑ", course: "Web Dev", members: 3, maxMembers: 5, tags: ["ÂºÄÂèë", "React"], lastMsg: "UIËÆæËÆ°ÂõæÂ•Ω‰∫Ü", 
            progress: 65, notice: "‰∏ãÂë®‰∏Ä‰πãÂâçÂøÖÈ°ªÂÆåÊàêÊâÄÊúâÁªÑ‰ª∂ÂºÄÂèëÔºÅ",
            tasks: [{ id: 1, title: "ÂÆåÊàêUIËÆæËÆ°", status: "done", assignee: "JOKER" }, { id: 2, title: "ReactÁéØÂ¢ÉÊê≠Âª∫", status: "in-progress", assignee: "SKULL" }, { id: 3, title: "APIÊé•Âè£ÂØπÊé•", status: "todo", assignee: "FOX" }], 
            theme: "bg-white",
            ranking: [{ name: "JOKER", score: 1500 }, { name: "SKULL", score: 800 }, { name: "FOX", score: 1200 }]
          },
          { 
            id: "g2", title: "È´òÊï∞ÊØèÊó•ÊâìÂç°", course: "Calculus", members: 42, maxMembers: 100, tags: ["Â≠¶‰π†"], lastMsg: "‰ªäÊó•È¢òÁõÆÂ∑≤ÂèëÂ∏É", 
            progress: 30, notice: "ÊØèÊó•Êó©Êô®8ÁÇπÊâìÂç°ÔºåËøûÁª≠7Â§©Â•ñÂä±ÁßØÂàÜ„ÄÇ",
            tasks: [], 
            theme: "bg-white",
            ranking: [{ name: "QUEEN", score: 2100 }, { name: "FOX", score: 1950 }]
          },
        ];

        const FILES = [
          { id: 1, name: "È´òÁ≠âÊï∞Â≠¶_Á¨¨‰∏ÄÁ´†.pdf", size: "2.4MB", type: "PDF" },
          { id: 2, name: "È°πÁõÆÈúÄÊ±ÇËßÑÊ†ºËØ¥Êòé‰π¶.docx", size: "1.1MB", type: "DOC" },
          { id: 3, name: "ËØæÁ®ãÁ¥†ÊùêÂåÖ.zip", size: "15MB", type: "ZIP" },
        ];
        
        const FLASHCARDS_DATA = [
          { id: 1, question: "React ‰∏≠ÁöÑ useEffect ÊòØ‰ªÄ‰πàÔºü", answer: "Â§ÑÁêÜÂâØ‰ΩúÁî®ÁöÑ HookÔºå‰æãÂ¶ÇÊï∞ÊçÆËé∑Âèñ„ÄÅËÆ¢ÈòÖÊàñÊâãÂä®‰øÆÊîπ DOM„ÄÇ" },
          { id: 2, question: "‰ªÄ‰πàÊòØÈó≠ÂåÖ (Closure)Ôºü", answer: "ÂáΩÊï∞ÂíåÂÖ∂Âë®Âõ¥Áä∂ÊÄÅÔºàËØçÊ≥ïÁéØÂ¢ÉÔºâÁöÑÂºïÁî®ÊçÜÁªëÂú®‰∏ÄËµ∑ÂΩ¢ÊàêÈó≠ÂåÖ„ÄÇ" },
          { id: 3, question: "HTTP Áä∂ÊÄÅÁ†Å 404 Ë°®Á§∫‰ªÄ‰πàÔºü", answer: "Not Found„ÄÇÊúçÂä°Âô®Êó†Ê≥ïÊâæÂà∞ËØ∑Ê±ÇÁöÑËµÑÊ∫ê„ÄÇ" },
          { id: 4, question: "ËÆæËÆ°Ê®°Âºè‰∏≠ÁöÑÂçï‰æãÊ®°ÂºèÊòØÔºü", answer: "‰øùËØÅ‰∏Ä‰∏™Á±ª‰ªÖÊúâ‰∏Ä‰∏™ÂÆû‰æãÔºåÂπ∂Êèê‰æõ‰∏Ä‰∏™ËÆøÈóÆÂÆÉÁöÑÂÖ®Â±ÄËÆøÈóÆÁÇπ„ÄÇ" },
          { id: 5, question: "È´òÁ≠âÊï∞Â≠¶ÔºöÂØºÊï∞ÁöÑÂá†‰ΩïÊÑè‰πâÔºü", answer: "ÂáΩÊï∞Âú®Êüê‰∏ÄÁÇπÂ§ÑÁöÑÂàáÁ∫øÁöÑÊñúÁéá„ÄÇ" },
        ];

        const MUSIC_TRACKS = [
          { id: 1, title: "Rainy Mood", artist: "Lo-Fi Beats", duration: "‚àû" },
          { id: 2, title: "Library Silence", artist: "White Noise", duration: "‚àû" },
          { id: 3, title: "Exam Focus", artist: "Alpha Waves", duration: "‚àû" },
        ];

        const CALENDAR_EVENTS = {
            "2023-11-14": { type: "deadline", title: "‰∫§‰∫íËÆæËÆ°‰Ωú‰∏öÊà™Ê≠¢", icon: AlertTriangle },
            "2023-11-18": { type: "exam", title: "È´òÊï∞Êúü‰∏≠ËÄÉËØï", icon: FileText },
            "2023-11-20": { type: "social", title: "Â∞èÁªÑËÅöÈ§ê", icon: Users },
            "2023-11-25": { type: "palace", title: "Êä¢‰øÆÈ°πÁõÆBUG", icon: Zap },
        };

        const WEATHER_TYPES = [
            { icon: Sun, label: "SUNNY" },
            { icon: Cloud, label: "CLOUDY" },
            { icon: CloudRain, label: "RAINY" },
            { icon: Wind, label: "WINDY" }
        ];

        const SOCIAL_POSTS = [
            { id: 1, user: "PANTHER", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Baby", time: "10 mins ago", content: "Áªà‰∫éÊêûÂÆö‰∫ÜÁî®Êà∑Ë∞ÉÁ†îÊä•ÂëäÔºÅËøôÂë®ÂèØ‰ª•Á®çÂæÆÊîæÊùæ‰∏Ä‰∏ã‰∫Ü„ÄÇüçµ #‰∫§‰∫íËÆæËÆ° #DeadlineÊàòÂ£´", likes: 12, comments: 3, liked: false },
            { id: 2, user: "SKULL", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka", time: "2 hours ago", content: "ÊïëÂëΩÔºåË∞ÅÊáÇReactÁöÑHooksÔºüuseEffectÊó†ÈôêÂæ™ÁéØ‰∫ÜÂïäÂïäÂïäÔºÅüíÄ", likes: 5, comments: 8, liked: true },
            { id: 3, user: "FOX", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Baby", time: "Yesterday", content: "Âú®Ëøô‰∏™ÂñßÂö£ÁöÑ‰∏ñÁïåÈáåÔºåÂîØÊúâÂõæ‰π¶È¶ÜÁöÑËßíËêΩËÉΩËÆ©ÊàëÊÑüÂèóÂà∞ÁâáÂàªÁöÑÂÆÅÈùô‰∏éËâ∫ÊúØÁöÑÁÅµÊÑü„ÄÇ", likes: 24, comments: 0, liked: false },
        ];

        const RUMORS_DATA = [
            { id: 1, content: "ÊçÆËØ¥ÊúüÊú´È´òÊï∞ËÄÉËØï‰ºöÂæàÈöæÔºåËÄÅÂ∏àÂú®ÊöóÁ§∫ÈáçÁÇπÊòØÂæÆÁßØÂàÜ...", heat: 95 },
            { id: 2, content: "Âõæ‰π¶È¶Ü‰∏âÊ•ºÈÇ£‰∏™ËßíËêΩÁöÑÂ∫ß‰ΩçÂ•ΩÂÉèËá™Â∏¶Â≠¶Èú∏ÂÖâÁéØÔºü", heat: 42 },
            { id: 3, content: "Âê¨ËØ¥È£üÂ†ÇÊñ∞Âá∫ÁöÑÂíñÂñ±È•≠ÂæàÈöæÂêÉÔºåÂ§ßÂÆ∂ÈÅøÈõ∑„ÄÇ", heat: 18 },
        ];

        // --- Core Logic ---
        const useRouter = (initialPage = "HOME") => {
          const [history, setHistory] = useState([{ name: initialPage, params: {} }]);
          const push = (pageName, params = {}) => setHistory((prev) => [...prev, { name: pageName, params }]);
          const pop = () => setHistory((prev) => (prev.length > 1 ? prev.slice(0, -1) : prev));
          const reset = (pageName) => setHistory([{ name: pageName, params: {} }]);
          return { currentPage: history[history.length - 1], push, pop, reset };
        };
        
        const callGemini = async (prompt) => {
           // Mocking AI response for static deployment
           return new Promise(resolve => setTimeout(() => resolve(`AIÁîüÊàêÁöÑÂª∫ËÆÆÔºöÂü∫‰∫é${prompt}ÁöÑÂàÜÊûêÁªìÊûú...`), 1000));
        };

        // --- Components ---
        const P5Button = ({ children, onClick, className = "", variant = "primary", disabled = false }) => {
          const variants = {
            primary: "bg-blue-600 text-white shadow-[4px_4px_0px_0px_black] hover:bg-yellow-400 hover:text-black",
            secondary: "bg-white text-black shadow-[4px_4px_0px_0px_black]",
            accent: "bg-yellow-400 text-black shadow-[4px_4px_0px_0px_black]",
            danger: "bg-red-600 text-white shadow-[4px_4px_0px_0px_black]",
            black: "bg-black text-white shadow-[4px_4px_0px_0px_#FACC15] hover:bg-white hover:text-black",
          };
          return (
            <button onClick={onClick} disabled={disabled} className={`group relative px-6 py-3 font-black italic transform -skew-x-6 border-2 border-black transition-all ${disabled ? "opacity-50 cursor-not-allowed" : "active:translate-y-1 active:shadow-none"} ${variants[variant]} ${className}`}>
              <div className="transform skew-x-6 flex items-center justify-center gap-2 uppercase tracking-widest">{children}</div>
            </button>
          );
        };

        const P5Header = ({ title, subtitle, rightAction, onBack }) => (
          <div className="sticky top-0 z-40 bg-blue-600 text-white border-b-4 border-black px-5 py-4 flex justify-between items-center shadow-md">
            <div className="flex items-center gap-3">
              {onBack && <button onClick={onBack} className="bg-white text-black p-1 border-2 border-black hover:bg-yellow-400 transition-colors"><ChevronLeft size={28} strokeWidth={3} /></button>}
              <div>
                <h1 className="text-3xl font-black italic tracking-tighter uppercase font-sans leading-none" style={{ textShadow: "2px 2px 0px black" }}>{title}</h1>
                {subtitle && <p className="text-[10px] font-black bg-yellow-400 text-black px-2 inline-block border border-black transform -skew-x-6 mt-1">{subtitle}</p>}
              </div>
            </div>
            <div>{rightAction}</div>
          </div>
        );

        const P5TabBar = ({ activeTab, onSwitchTab }) => {
          const tabs = [
            { id: "HOME", label: "È¶ñÈ°µ", icon: BookOpen },
            { id: "MATCH", label: "ÂåπÈÖç", icon: Search },
            { id: "FOCUS", label: "‰∏ìÊ≥®", icon: Zap, isFab: true },
            { id: "GROUPS", label: "Â∞èÁªÑ", icon: Users },
            { id: "PROFILE", label: "ÊàëÁöÑ", icon: User },
          ];
          return (
            <div className="fixed bottom-0 left-0 right-0 z-50 pointer-events-none">
              <div className="absolute bottom-0 w-full h-20 bg-black border-t-4 border-blue-600 pointer-events-auto"></div>
              <div className="relative flex justify-between items-end px-4 pb-4 h-24 max-w-md mx-auto pointer-events-auto">
                {tabs.map((tab) => (
                  <div key={tab.id} className={tab.isFab ? "relative -top-5 mx-2" : "mb-2"}>
                    <button onClick={() => onSwitchTab(tab.id)} className={`flex flex-col items-center gap-1 transition-all ${tab.isFab ? "w-16 h-16 bg-yellow-400 border-4 border-black transform rotate-45 hover:scale-105 active:scale-95" : activeTab === tab.id ? "text-blue-400 scale-110" : "text-gray-400"}`}>
                      <tab.icon size={24} className={tab.isFab ? "transform -rotate-45" : ""} strokeWidth={3} />
                      {!tab.isFab && <span className={`text-[10px] font-black italic uppercase ${activeTab === tab.id ? "bg-white text-blue-600 px-1 transform -skew-x-6" : ""}`}>{tab.label}</span>}
                    </button>
                  </div>
                ))}
              </div>
            </div>
          );
        };
        
        const StarBurst = ({ className }) => (
          <div className={`bg-black text-white flex items-center justify-center ${className}`} style={{ clipPath: "polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)" }}>
            <div className="w-full h-full bg-yellow-400 scale-75" style={{ clipPath: "inherit" }}></div>
          </div>
        );

        // --- Views ---
        const HomeView = ({ router }) => (
          <div className="pb-28 bg-gray-100 min-h-screen animate-fade-in">
            <P5Header 
              title="ACADEMY" 
              subtitle={`USER: ${CURRENT_USER.name}`} 
              rightAction={
                <div className="flex gap-2">
                    <button onClick={() => router.push("MESSAGES")} className="bg-white text-black p-2 border-2 border-black hover:bg-yellow-400 transition-colors"><Mail size={20} /></button>
                    <button onClick={() => router.push("NOTIFICATIONS")} className="bg-white text-black p-2 border-2 border-black hover:bg-yellow-400 transition-colors"><Bell size={20} /></button>
                </div>
              } 
            />
            <div className="px-5 mt-6 space-y-8">
              
              {/* Main CTA */}
              <div className="relative cursor-pointer group" onClick={() => router.push("FOCUS")}>
                <div className="absolute inset-0 bg-black translate-x-2 translate-y-2 group-hover:translate-x-3 group-hover:translate-y-3 transition-transform"></div>
                <div className="relative bg-blue-600 p-6 text-white border-2 border-black overflow-hidden group-hover:-translate-y-1 transition-transform">
                  <h2 className="text-3xl font-black italic uppercase tracking-tighter" style={{ textShadow: "3px 3px 0px black" }}>Seize The<br />Knowledge</h2>
                  <div className="mt-4 flex justify-between items-center">
                    <div className="bg-yellow-400 text-black border border-black px-3 py-1 font-bold text-xs transform -skew-x-12">‰ªäÊó•‰∏ìÊ≥®: 45 MINS</div>
                    <div className="w-12 h-12 bg-black border-2 border-white rounded-full flex items-center justify-center animate-pulse"><Play size={24} fill="#FACC15" /></div>
                  </div>
                </div>
              </div>

              {/* Grid Menu - Expanded with NEW FEATURES */}
              <div className="grid grid-cols-2 gap-4">
                {[
                  { icon: MessageSquare, label: "Â≠¶‰º¥Âúà", p: "BUDDY_SQUARE", c: "bg-black text-white" }, 
                  { icon: Home, label: "ÁßòÂØÜÂü∫Âú∞", p: "SAFE_HOUSE", c: "bg-red-600 text-white" }, // NEW: Safe House
                  { icon: Eye, label: "ÊÄ™Áõó‰º†Èóª", p: "RUMORS", c: "bg-white" }, // NEW: Rumors
                  { icon: Scroll, label: "Â≠¶‰π†Â•ëÁ∫¶", p: "PACTS", c: "bg-white" }, 
                  { icon: AlertCircle, label: "ÊÇ¨ËµèÊ±ÇÂä©", p: "REQUESTS", c: "bg-yellow-400 text-black" }, 
                  { icon: Video, label: "‰∫ëËá™‰π†ÂÆ§", p: "CLOUD_ROOM", c: "bg-blue-600 text-white" }, 
                  { icon: Target, label: "ÁõÆÊ†á", p: "GOALS", c: "bg-black text-white" },
                  { icon: MapPin, label: "Âç†Â∫ß", p: "SEATS", c: "bg-white" },
                  { icon: ShoppingBag, label: "Áü•ËØÜÈõÜÂ∏Ç", p: "MARKET", c: "bg-white" }, 
                  { icon: Sword, label: "‰∏ìÊ≥®ÂØπÂÜ≥", p: "DUEL", c: "bg-red-600 text-white" }, 
                  { icon: Stamp, label: "ÊØèÊó•Á≠æÂà∞", p: "CHECKIN", c: "bg-white" }, 
                  { icon: Clock, label: "ÂÄíÊï∞Êó•", p: "COUNTDOWN", c: "bg-white" },
                  { icon: Calendar, label: "Ë°å‰∫ãÂéÜ", p: "CALENDAR", c: "bg-white" }, 
                  { icon: Brain, label: "ËÆ∞ÂøÜÂÆ´ÊÆø", p: "FLASHCARDS", c: "bg-black text-white" }, 
                ].map((item, i) => (
                  <div key={i} onClick={() => router.push(item.p)} className={`p-4 border-2 border-black cursor-pointer shadow-[4px_4px_0px_0px_black] transition-all hover:-translate-y-1 hover:shadow-[6px_6px_0px_0px_black] ${item.c}`}>
                    <div className="flex items-center gap-3"><item.icon size={24} strokeWidth={2.5} /><span className="font-black italic text-lg uppercase leading-none">{item.label}</span></div>
                  </div>
                ))}
              </div>

              {/* Schedule Section */}
              <div>
                <div className="flex items-center justify-between mb-4 border-b-4 border-black pb-1"><h3 className="text-2xl font-black italic bg-black text-white px-2">Êó•Á®ãË°® SCHEDULE</h3></div>
                <div className="space-y-4">
                  {COURSES.slice(0, 2).map((c) => (
                    <div key={c.id} className="flex group cursor-pointer" onClick={() => router.push("COURSE_DETAIL", { course: c })}>
                      <div className="w-16 pt-2 font-black text-xl italic text-gray-400">{c.time}</div>
                      <div className={`flex-1 p-4 border-2 border-black shadow-[4px_4px_0px_0px_black] transition-transform group-hover:-translate-y-1 ${c.theme}`}>
                        <h4 className="font-black text-lg uppercase mb-1">{c.name}</h4>
                        <span className="text-xs font-bold border border-current px-1">{c.location}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );

        // --- Feature: Safe House (ÁßòÂØÜÂü∫Âú∞) ---
        const SafeHouseView = ({ router }) => (
            <div className="bg-slate-900 min-h-screen animate-fade-in pb-28 relative overflow-hidden">
                <P5Header title="ÁßòÂØÜÂü∫Âú∞" subtitle="SAFE HOUSE" onBack={router.pop} />
                <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                
                {/* Scene */}
                <div className="p-6 relative z-10 flex flex-col items-center">
                    <div className="w-full bg-black/50 border-4 border-red-600 p-6 backdrop-blur-sm transform -rotate-1 mb-6">
                        <h3 className="text-red-500 font-black italic text-2xl uppercase mb-4 border-b-2 border-red-500 pb-2">TEAM STATUS</h3>
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-white rounded-full border-2 border-black overflow-hidden"><img src={CURRENT_USER.avatar} /></div>
                                <div className="flex-1 bg-white h-4 border-2 border-black relative"><div className="h-full bg-blue-600 w-[80%]"></div></div>
                                <span className="text-white font-black italic">HP</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-gray-300 rounded-full border-2 border-black overflow-hidden"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" /></div>
                                <div className="flex-1 bg-white h-4 border-2 border-black relative"><div className="h-full bg-green-500 w-[60%]"></div></div>
                                <span className="text-white font-black italic">SP</span>
                            </div>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4 w-full">
                        <button className="bg-yellow-400 text-black p-4 border-4 border-black font-black italic uppercase shadow-[4px_4px_0px_black] hover:bg-white transition-colors">
                            <MapIcon className="mb-2" />
                            Mission Log
                        </button>
                        <button className="bg-white text-black p-4 border-4 border-black font-black italic uppercase shadow-[4px_4px_0px_black] hover:bg-yellow-400 transition-colors">
                            <Coffee className="mb-2" />
                            Relax
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- Feature: Rumors (ÊÄ™Áõó‰º†Èóª) ---
        const RumorsView = ({ router }) => (
            <div className="bg-black min-h-screen animate-fade-in pb-28">
                <P5Header title="ÊÄ™Áõó‰º†Èóª" subtitle="PHANTOM RUMORS" onBack={router.pop} />
                <div className="px-5 mt-6 space-y-6">
                    <div className="bg-red-600 text-white p-4 border-2 border-white transform rotate-1 text-center font-black italic">
                        "The truth is hidden in the noise..."
                    </div>
                    
                    {RUMORS_DATA.map(r => (
                        <div key={r.id} className="relative group cursor-pointer hover:scale-105 transition-transform">
                            <div className="bg-gray-900 border-2 border-gray-600 p-4 relative z-10">
                                <div className="flex justify-between items-start mb-2">
                                    <span className="text-red-500 font-black text-xs border border-red-500 px-1">RUMOR #{r.id}</span>
                                    <span className="text-yellow-400 font-bold text-xs">{r.heat}% HEAT</span>
                                </div>
                                <p className="text-white font-bold italic text-lg">"{r.content}"</p>
                                <div className="w-full bg-gray-800 h-1 mt-3">
                                    <div className="h-full bg-red-600" style={{width: `${r.heat}%`}}></div>
                                </div>
                            </div>
                            <div className="absolute inset-0 border-2 border-red-600 transform translate-x-1 translate-y-1 z-0"></div>
                        </div>
                    ))}
                    
                    <P5Button className="w-full" variant="danger">SUBMIT INTEL</P5Button>
                </div>
            </div>
        );

        // --- Match View ---
        const MatchView = ({ router }) => {
          const [filter, setFilter] = useState("ÂÖ®ÈÉ®");
          const filtered = filter === "ÂÖ®ÈÉ®" ? BUDDY_RECOMMENDATIONS : BUDDY_RECOMMENDATIONS.filter(b => b.category === filter);
          return (
            <div className="pb-28 min-h-screen bg-white bg-[radial-gradient(#2563EB_1px,transparent_1px)] [background-size:16px_16px]">
              <P5Header title="ÂØªÊâæÂêå‰º¥" subtitle="CONFIDANT" rightAction={<Filter size={24} />} />
              
              {/* Function Buttons */}
              <div className="p-5 grid grid-cols-3 gap-3 border-b-4 border-black bg-gray-100">
                  <div onClick={() => router.push("PERSONA_TEST")} className="bg-black text-white p-3 border-2 border-black flex flex-col items-center justify-center cursor-pointer shadow-[3px_3px_0px_0px_#FACC15] active:shadow-none active:translate-y-1 transition-all group">
                      <Fingerprint size={24} className="mb-1 text-yellow-400 group-hover:scale-110 transition-transform" />
                      <span className="text-[10px] font-black italic uppercase">‰∫∫Ê†ºÊµãËØï</span>
                  </div>
                  <div onClick={() => router.push("RADAR")} className="bg-red-600 text-white p-3 border-2 border-black flex flex-col items-center justify-center cursor-pointer shadow-[3px_3px_0px_0px_black] active:shadow-none active:translate-y-1 transition-all group">
                      <Radio size={24} className="mb-1 group-hover:animate-pulse" />
                      <span className="text-[10px] font-black italic uppercase">ÂºÇÁïåÈõ∑Ëææ</span>
                  </div>
                  <div onClick={() => router.push("BOTTLE")} className="bg-white text-black p-3 border-2 border-black flex flex-col items-center justify-center cursor-pointer shadow-[3px_3px_0px_0px_black] active:shadow-none active:translate-y-1 transition-all group">
                      <Mail size={24} className="mb-1 group-hover:rotate-12 transition-transform" />
                      <span className="text-[10px] font-black italic uppercase">È¢ÑÂëäÂáΩ</span>
                  </div>
              </div>

              <div className="px-5 mt-6 space-y-6">
                <div className="flex gap-2 overflow-x-auto pb-2 hide-scrollbar">{["ÂÖ®ÈÉ®", "ÂºÄÂèë", "ËÆæËÆ°", "È´òÊï∞", "Ëá™‰π†"].map(t => <button key={t} onClick={() => setFilter(t)} className={`px-4 py-1 border-2 border-black font-black italic whitespace-nowrap transition-all ${filter === t ? "bg-blue-600 text-white shadow-[3px_3px_0px_black] -translate-y-1" : "bg-white"}`}>{t}</button>)}</div>
                {filtered.map((buddy, idx) => (
                  <div key={buddy.id} onClick={() => router.push("BUDDY_DETAIL", { buddy })} className="relative group cursor-pointer animate-pop">
                    <div className="absolute inset-0 bg-black translate-x-2 translate-y-2"></div>
                    <div className={`relative bg-white border-2 border-black transform ${idx % 2 === 0 ? "-rotate-1" : "rotate-1"} group-hover:rotate-0`}>
                      <div className="bg-black text-white p-2 flex justify-between px-4"><span className="font-black italic uppercase tracking-widest">{buddy.style}</span><span className="text-yellow-400 font-black italic">{buddy.matchScore}%</span></div>
                      <div className="p-4 flex gap-4"><img src={buddy.avatar} className="w-16 h-16 border-2 border-black object-cover" /><div><h3 className="text-2xl font-black italic text-blue-600 uppercase leading-none mb-1">{buddy.name}</h3><div className="flex gap-1 mb-1"><span className="bg-blue-600 text-white text-[10px] px-1 font-bold">{buddy.major}</span><span className="bg-gray-200 text-black text-[10px] px-1 font-bold">{buddy.freeTime || "ÊúâÁ©∫"}</span></div><p className="text-xs italic line-clamp-1 font-bold">"{buddy.desc}"</p></div></div>
                      <div className="border-t-2 border-black flex"><button className="flex-1 py-2 font-black uppercase text-sm border-r-2 border-black hover:bg-gray-100">Info</button><button className="flex-1 py-2 font-black bg-yellow-400 uppercase text-sm hover:bg-black hover:text-yellow-400">Connect</button></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        };

        // --- Feature: Persona Test ---
        const PersonaTestView = ({ router }) => (
            <div className="bg-black min-h-screen animate-fade-in pb-28 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                <P5Header title="‰∫∫Ê†ºÊµãËØï" subtitle="SOUL SEARCH" onBack={router.pop} />
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')] opacity-10"></div>
                
                <div className="relative z-10 w-full max-w-sm text-center">
                    <div className="bg-blue-600 text-white p-8 border-4 border-white transform rotate-2 shadow-[8px_8px_0px_0px_#FACC15]">
                        <h2 className="text-3xl font-black italic uppercase mb-6 leading-tight">Question 1</h2>
                        <p className="text-lg font-bold mb-8">ÈÅáÂà∞ÈöæÈ¢òÊó∂Ôºå‰Ω†Êõ¥ÂÄæÂêë‰∫éÔºü</p>
                        <div className="space-y-4">
                            <button className="w-full bg-black text-white py-3 border-2 border-white hover:bg-white hover:text-black font-black italic uppercase transition-colors">Áã¨Ëá™ÈíªÁ†î</button>
                            <button className="w-full bg-black text-white py-3 border-2 border-white hover:bg-white hover:text-black font-black italic uppercase transition-colors">ÂØªÊâæ‰ºô‰º¥ËÆ®ËÆ∫</button>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- Feature: Radar ---
        const RadarView = ({ router }) => (
            <div className="bg-slate-900 min-h-screen animate-fade-in pb-28 relative overflow-hidden">
                <P5Header title="ÂºÇÁïåÈõ∑Ëææ" subtitle="METAVERSE SCAN" onBack={router.pop} />
                
                <div className="absolute inset-0 flex items-center justify-center">
                    {/* Radar Circles */}
                    <div className="w-[600px] h-[600px] border border-red-600/30 rounded-full absolute animate-ping" style={{animationDuration: '3s'}}></div>
                    <div className="w-[400px] h-[400px] border border-red-600/50 rounded-full absolute"></div>
                    <div className="w-[200px] h-[200px] border-2 border-red-600 rounded-full absolute flex items-center justify-center">
                        <div className="w-full h-1 bg-red-600 absolute animate-spin"></div>
                    </div>
                    
                    {/* Blips */}
                    <div className="absolute top-1/3 left-1/4 animate-bounce">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" className="w-12 h-12 rounded-full border-2 border-white" />
                        <div className="bg-black text-white text-[10px] px-1 font-bold absolute -bottom-4 left-0">SKULL</div>
                    </div>
                    <div className="absolute bottom-1/3 right-1/4 animate-pulse">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Baby" className="w-12 h-12 rounded-full border-2 border-white" />
                        <div className="bg-black text-white text-[10px] px-1 font-bold absolute -bottom-4 left-0">FOX</div>
                    </div>
                </div>
                
                <div className="absolute bottom-32 w-full text-center px-6">
                    <div className="bg-black/80 text-white p-4 border-2 border-red-600">
                        <p className="font-mono font-bold text-red-500 animate-pulse">2 SIGNALS DETECTED</p>
                    </div>
                </div>
            </div>
        );

        // --- Feature: Bottle (Calling Card) ---
        const BottleView = ({ router }) => (
            <div className="bg-red-600 min-h-screen animate-fade-in pb-28 flex flex-col">
                <P5Header title="È¢ÑÂëäÂáΩ" subtitle="CALLING CARD" onBack={router.pop} />
                
                <div className="flex-1 p-6 flex flex-col items-center justify-center">
                    <div className="bg-black p-1 w-full max-w-sm transform -rotate-2">
                        <div className="bg-white p-6 border-2 border-red-600">
                            <h2 className="text-4xl font-black italic text-center mb-2 uppercase text-red-600" style={{fontFamily: 'Impact'}}>Take Your Heart</h2>
                            <textarea className="w-full h-32 border-2 border-black p-2 font-bold text-sm resize-none mb-4 bg-gray-100" placeholder="Ëá¥ Êüê‰ΩçÊú™Áü•ÁöÑÊÄ™Áõó..."></textarea>
                            <div className="text-right">
                                <span className="font-black italic text-black bg-red-600 text-white px-2">FROM: {CURRENT_USER.name}</span>
                            </div>
                        </div>
                    </div>
                    
                    <P5Button className="w-full max-w-sm mt-8" variant="black">ÂèëÈÄÅÈ¢ÑÂëä</P5Button>
                </div>
            </div>
        );

        // --- View 1: Â≠¶‰º¥Âúà (Buddy Loop / Feed) ---
        const BuddySquareView = ({ router }) => {
            const [posts, setPosts] = useState(SOCIAL_POSTS);
            const [newPostContent, setNewPostContent] = useState("");
            const [isPosting, setIsPosting] = useState(false);

            const toggleLike = (id) => {
                setPosts(posts.map(p => p.id === id ? { ...p, liked: !p.liked, likes: p.liked ? p.likes - 1 : p.likes + 1 } : p));
            };

            const handlePost = () => {
                if(!newPostContent.trim()) return;
                setIsPosting(true);
                setTimeout(() => {
                    const post = {
                        id: Date.now(),
                        user: CURRENT_USER.name,
                        avatar: CURRENT_USER.avatar,
                        time: "Just now",
                        content: newPostContent,
                        likes: 0,
                        comments: 0,
                        liked: false
                    };
                    setPosts([post, ...posts]);
                    setNewPostContent("");
                    setIsPosting(false);
                }, 800);
            };

            return (
                <div className="bg-gray-100 min-h-screen animate-fade-in pb-28">
                    <P5Header title="Â≠¶‰º¥Âúà" subtitle="COOP NETWORK" onBack={router.pop} />
                    
                    {/* Post Creator */}
                    <div className="bg-slate-900 p-5 border-b-4 border-black">
                        <div className="flex gap-4">
                            <img src={CURRENT_USER.avatar} className="w-12 h-12 border-2 border-white bg-gray-200" />
                            <div className="flex-1">
                                <textarea 
                                    value={newPostContent}
                                    onChange={(e) => setNewPostContent(e.target.value)}
                                    className="w-full bg-black text-white border-2 border-gray-600 p-3 font-bold text-sm outline-none focus:border-yellow-400 transition-colors transform -skew-x-2"
                                    placeholder="ÂàÜ‰∫´‰ªäÊó•Â≠¶‰π†ËøõÂ∫¶..."
                                    rows="2"
                                />
                                <div className="flex justify-between items-center mt-2">
                                    <button className="text-gray-400 hover:text-white"><Camera size={20} /></button>
                                    <button onClick={handlePost} disabled={isPosting} className="bg-red-600 text-white px-4 py-1 font-black italic border-2 border-white hover:bg-white hover:text-red-600 transform skew-x-6 text-xs uppercase">
                                        {isPosting ? "SENDING..." : "POST"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Feed List */}
                    <div className="px-5 mt-6 space-y-6">
                        {posts.map((post) => (
                            <div key={post.id} className="relative group">
                                {/* Decor */}
                                <div className="absolute top-0 right-0 w-8 h-8 bg-gray-200 border-2 border-black transform rotate-12 translate-x-2 -translate-y-2 z-0"></div>
                                
                                <div className="relative bg-white border-2 border-black p-5 shadow-[6px_6px_0px_0px_black] z-10 transition-transform group-hover:-translate-y-1">
                                    <div className="flex items-center justify-between mb-3">
                                        <div className="flex items-center gap-3">
                                            <img src={post.avatar} className="w-10 h-10 border-2 border-black" />
                                            <div>
                                                <h4 className="font-black italic text-lg leading-none">{post.user}</h4>
                                                <span className="text-[10px] font-bold text-gray-500 uppercase">{post.time}</span>
                                            </div>
                                        </div>
                                        <button className="text-gray-400 hover:text-black"><Settings size={16} /></button>
                                    </div>
                                    
                                    <p className="font-bold text-gray-800 leading-relaxed mb-4">{post.content}</p>
                                    
                                    {/* Actions */}
                                    <div className="flex items-center gap-6 border-t-2 border-gray-100 pt-3">
                                        <button 
                                            onClick={() => toggleLike(post.id)}
                                            className={`flex items-center gap-1 font-black text-sm transition-colors ${post.liked ? 'text-red-600' : 'text-gray-400 hover:text-black'}`}
                                        >
                                            <Heart size={18} fill={post.liked ? "currentColor" : "none"} />
                                            {post.likes}
                                        </button>
                                        <button className="flex items-center gap-1 font-black text-sm text-gray-400 hover:text-black">
                                            <MessageCircle size={18} />
                                            {post.comments}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        <div className="text-center py-4">
                            <span className="inline-block bg-black text-white px-2 py-1 text-xs font-black italic transform -skew-x-12 border border-white">END OF NETWORK</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- NEW View 2: ÊÇ¨ËµèÊ±ÇÂä© (Requests) ---
        const RequestBoardView = ({ router }) => {
            const requests = [
                { id: 1, user: "SKULL", title: "Ê±ÇÈ´òÊï∞Á¨îËÆ∞", desc: "ÈîôËøá‰∫Ü‰∏ÄËäÇËØæÔºåÊ±ÇÁ¨¨‰∫åÁ´†Á¨îËÆ∞ÔºÅ", reward: "‚òï Coffee", tags: ["MATH"] },
                { id: 2, user: "FOX", title: "‰∫∫‰ΩìÁªìÊûÑÁ¥†ÊèèÊ®°Áâπ", desc: "ÈúÄË¶Å‰∏Ä‰ΩçÊ®°ÁâπÔºåÂ§ßÊ¶Ç30ÂàÜÈíüÔºåÂè™ÂùêÁùÄ‰∏çÂä®Â∞±Ë°å„ÄÇ", reward: "üé® Portrait", tags: ["ART"] },
            ];
            return (
                <div className="bg-yellow-400 min-h-screen animate-fade-in pb-28">
                    <P5Header title="ÊÇ¨ËµèÊ±ÇÂä©" subtitle="REQUEST CHANNEL" onBack={router.pop} />
                    <div className="px-5 mt-6 space-y-4">
                        {requests.map(r => (
                            <div key={r.id} className="bg-white border-2 border-black p-4 shadow-[6px_6px_0px_black] relative overflow-hidden group">
                                <div className="absolute top-0 right-0 bg-red-600 text-white text-xs font-black px-2 py-1 transform rotate-12 translate-x-2 -translate-y-1">WANTED</div>
                                <h3 className="text-2xl font-black italic uppercase mb-2">{r.title}</h3>
                                <p className="font-bold text-sm mb-4">"{r.desc}"</p>
                                <div className="flex justify-between items-center border-t-2 border-black pt-3">
                                    <div className="flex gap-2">
                                        <span className="bg-black text-white text-xs px-2 py-1 font-black italic">{r.user}</span>
                                        <span className="bg-gray-200 text-black text-xs px-2 py-1 font-bold">{r.reward}</span>
                                    </div>
                                    <button className="font-black italic hover:text-red-600 uppercase">ACCEPT</button>
                                </div>
                            </div>
                        ))}
                         <P5Button className="w-full mt-4" variant="black">ÂèëÂ∏ÉÊÇ¨Ëµè</P5Button>
                    </div>
                </div>
            );
        };

        // --- NEW View 3: Â≠¶‰π†Â•ëÁ∫¶ (Pacts) ---
        const StudyPactView = ({ router }) => (
            <div className="bg-slate-900 min-h-screen animate-fade-in pb-28 text-white">
                <P5Header title="Â≠¶‰π†Â•ëÁ∫¶" subtitle="CONFIDANT PACT" onBack={router.pop} />
                <div className="p-6 flex flex-col items-center">
                    <div className="w-full bg-white text-black p-8 border-4 border-red-600 transform -rotate-1 shadow-[0px_0px_20px_rgba(220,38,38,0.5)] relative mb-8">
                        <h2 className="text-4xl font-black italic text-center mb-6 uppercase tracking-widest border-b-4 border-black pb-4">CONTRACT</h2>
                        <div className="space-y-4 font-bold font-mono text-sm uppercase">
                            <div className="flex justify-between border-b border-gray-300 pb-2"><span>I, THE UNDERSIGNED:</span> <span>{CURRENT_USER.name}</span></div>
                            <div className="flex justify-between border-b border-gray-300 pb-2"><span>PLEDGE TO:</span> <span>Study 40 Hours</span></div>
                            <div className="flex justify-between border-b border-gray-300 pb-2"><span>WITH BUDDY:</span> <span>MORGANA</span></div>
                            <div className="flex justify-between border-b border-gray-300 pb-2"><span>PENALTY:</span> <span>Buy Lunch</span></div>
                        </div>
                        <div className="mt-8 flex justify-center">
                            <div className="w-24 h-24 border-4 border-red-600 rounded-full flex items-center justify-center transform -rotate-12 opacity-50">
                                <span className="text-red-600 font-black text-xl">SIGNED</span>
                            </div>
                        </div>
                    </div>
                    <P5Button className="w-full" variant="danger">Á≠æËÆ¢Êñ∞Â•ëÁ∫¶</P5Button>
                </div>
            </div>
        );

        // --- NEW View 4: ‰∫ëËá™‰π†ÂÆ§ (Cloud Room) ---
        const CloudRoomView = ({ router }) => (
            <div className="bg-gray-800 min-h-screen animate-fade-in pb-28 relative overflow-hidden">
                <P5Header title="‰∫ëËá™‰π†ÂÆ§" subtitle="VIRTUAL LIBRARY" onBack={router.pop} />
                <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]"></div>
                
                {/* Visual Room */}
                <div className="relative z-10 p-6 grid grid-cols-2 gap-8 mt-10">
                    {/* Seat 1 */}
                    <div className="flex flex-col items-center">
                        <div className="w-24 h-24 bg-yellow-400 rounded-full border-4 border-black relative flex items-center justify-center shadow-[0_0_15px_rgba(250,204,21,0.5)]">
                             <img src={CURRENT_USER.avatar} className="w-20 h-20 rounded-full" />
                             <div className="absolute -top-2 -right-2 bg-red-600 text-white text-xs px-2 py-1 font-black border border-black transform rotate-12">FOCUSING</div>
                        </div>
                        <div className="mt-4 bg-black text-white px-4 py-1 font-bold italic border border-white transform -skew-x-12">YOU</div>
                    </div>
                    
                    {/* Seat 2 */}
                    <div className="flex flex-col items-center opacity-50">
                        <div className="w-24 h-24 bg-gray-600 rounded-full border-4 border-black border-dashed flex items-center justify-center">
                            <Plus size={32} className="text-gray-400" />
                        </div>
                        <div className="mt-4 bg-gray-900 text-gray-500 px-4 py-1 font-bold italic border border-gray-600 transform -skew-x-12">EMPTY</div>
                    </div>
                    
                     {/* Seat 3 (Buddy) */}
                    <div className="flex flex-col items-center">
                        <div className="w-24 h-24 bg-blue-600 rounded-full border-4 border-black relative flex items-center justify-center">
                             <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" className="w-20 h-20 rounded-full grayscale" />
                             <div className="absolute bottom-0 right-0 bg-black text-white p-1 rounded-full"><Coffee size={12}/></div>
                        </div>
                        <div className="mt-4 bg-white text-black px-4 py-1 font-bold italic border border-black transform -skew-x-12">SKULL</div>
                    </div>
                </div>
                
                <div className="absolute bottom-32 w-full px-6 text-center">
                    <p className="text-gray-400 font-mono text-sm mb-4">Current Noise Level: Low</p>
                    <P5Button className="w-full">ÂÖ•Â∫ß</P5Button>
                </div>
            </div>
        );

        // --- NEW View 5: Áü•ËØÜÈõÜÂ∏Ç (Market) ---
        const MarketView = ({ router }) => (
            <div className="bg-white min-h-screen animate-fade-in pb-28">
                <P5Header title="Áü•ËØÜÈõÜÂ∏Ç" subtitle="DARK NET" onBack={router.pop} />
                <div className="px-5 mt-6 grid grid-cols-2 gap-4">
                    {[{t:"È´òÊï∞Á¨îËÆ∞", p:"50 Coins", c:"bg-black text-white"}, {t:"Ëã±ËØ≠ËæÖÂØº", p:"100 Coins", c:"bg-blue-600 text-white"}, {t:"ÊúüÊú´ÊäºÈ¢ò", p:"200 Coins", c:"bg-red-600 text-white"}].map((m, i) => (
                        <div key={i} className={`p-4 border-2 border-black shadow-[4px_4px_0px_black] ${m.c}`}>
                            <ShoppingBag size={24} className="mb-2" />
                            <h4 className="font-black italic text-lg">{m.t}</h4>
                            <p className="font-mono font-bold text-sm mt-1 text-yellow-400">{m.p}</p>
                        </div>
                    ))}
                </div>
            </div>
        );

        // --- NEW View 6: ‰∏ìÊ≥®ÂØπÂÜ≥ (Duel) ---
        const DuelView = ({ router }) => (
            <div className="bg-red-600 min-h-screen animate-fade-in pb-28 flex flex-col items-center">
                 <P5Header title="‰∏ìÊ≥®ÂØπÂÜ≥" subtitle="1v1 BATTLE" onBack={router.pop} />
                 
                 <div className="flex-1 flex flex-col justify-center items-center w-full px-4 relative">
                     {/* VS Graphic */}
                     <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                         <span className="text-[200px] font-black italic text-black opacity-20" style={{fontFamily:'Impact'}}>VS</span>
                     </div>
                     
                     <div className="flex justify-between w-full items-end mb-8 relative z-10">
                         <div className="text-center">
                             <img src={CURRENT_USER.avatar} className="w-24 h-24 border-4 border-white bg-black mb-2" />
                             <div className="bg-black text-white font-black italic px-2 transform -skew-x-12">YOU</div>
                             <div className="text-4xl font-black text-white mt-2">45<span className="text-sm">min</span></div>
                         </div>
                         <div className="text-center">
                             <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Baby" className="w-24 h-24 border-4 border-black bg-white mb-2" />
                             <div className="bg-white text-black font-black italic px-2 transform skew-x-12">PANTHER</div>
                             <div className="text-4xl font-black text-black mt-2">30<span className="text-sm">min</span></div>
                         </div>
                     </div>
                     
                     <div className="w-full bg-black h-4 border-2 border-white relative z-10">
                         <div className="h-full bg-yellow-400 w-[60%]"></div>
                     </div>
                     <p className="text-white font-black italic mt-4 uppercase tracking-widest relative z-10">You are leading!</p>
                 </div>
                 
                 <div className="w-full px-6 relative z-10">
                    <P5Button className="w-full" variant="black">ÊåëÊàòÂØπÊâã</P5Button>
                 </div>
            </div>
        );

         // --- NEW View 7: ÊØèÊó•Á≠æÂà∞ (Checkin) ---
        const CheckinView = ({ router }) => (
            <div className="bg-white min-h-screen animate-fade-in pb-28">
                <P5Header title="ÊØèÊó•Á≠æÂà∞" subtitle="ATTENDANCE" onBack={router.pop} />
                <div className="p-6 flex flex-wrap gap-2 justify-center mt-4">
                    {Array.from({length: 30}).map((_, i) => (
                        <div key={i} className={`w-12 h-12 border-2 border-black flex items-center justify-center font-black relative ${i < 14 ? 'bg-gray-200 text-gray-400' : ''}`}>
                            {i+1}
                            {i < 14 && (
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="w-10 h-10 border-4 border-red-600 rounded-full flex items-center justify-center opacity-80 transform rotate-[-15deg]">
                                        <span className="text-[8px] font-black text-red-600 uppercase">Clear</span>
                                    </div>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
                <div className="px-6 text-center">
                    <h3 className="text-2xl font-black italic uppercase mb-2">STREAK: 14 DAYS</h3>
                    <P5Button className="w-full mt-4">‰ªäÊó•ÁõñÁ´†</P5Button>
                </div>
            </div>
        );

        const CalendarView = ({ router }) => {
            const today = new Date();
            const [selectedDate, setSelectedDate] = useState(14); // Mock selected date
            const daysInMonth = 30; // Mock Nov
            const startDay = 3; // Mock Wed

            const getEventForDay = (day) => {
                const dateStr = `2023-11-${day.toString().padStart(2, '0')}`;
                return CALENDAR_EVENTS[dateStr];
            };

            const selectedEvent = getEventForDay(selectedDate);
            const currentWeather = WEATHER_TYPES[selectedDate % 4];

            return (
                <div className="bg-gray-100 min-h-screen animate-fade-in pb-28 overflow-x-hidden">
                    <P5Header title="11Êúà" subtitle="NOVEMBER" onBack={router.pop} />
                    
                    {/* Top Date & Weather Indicator */}
                    <div className="relative bg-slate-900 text-white p-6 overflow-hidden border-b-4 border-black">
                        {/* Background Shapes */}
                        <div className="absolute top-0 right-0 w-64 h-full bg-slate-800 transform -skew-x-12 translate-x-12 z-0"></div>
                        <div className="relative z-10 flex justify-between items-end">
                            <div>
                                <div className="text-6xl font-black italic font-sans leading-none tracking-tighter" style={{textShadow: "4px 4px 0px #DC2626"}}>{selectedDate}</div>
                                <div className="text-xl font-bold bg-white text-black px-2 inline-block transform -skew-x-12 border-2 border-black mt-2 uppercase">Tuesday</div>
                            </div>
                            <div className="flex flex-col items-end">
                                <currentWeather.icon size={48} className="text-yellow-400 drop-shadow-[2px_2px_0px_black]" />
                                <span className="font-black italic text-lg">{currentWeather.label}</span>
                            </div>
                        </div>
                    </div>

                    <div className="p-5">
                        {/* Days Grid */}
                        <div className="grid grid-cols-7 gap-1 mb-6">
                            {['S','M','T','W','T','F','S'].map(d => (
                                <div key={d} className="text-center font-black italic text-gray-400 text-sm">{d}</div>
                            ))}
                            {Array.from({ length: startDay }).map((_, i) => <div key={`empty-${i}`} />)}
                            {Array.from({ length: daysInMonth }).map((_, i) => {
                                const day = i + 1;
                                const isSelected = day === selectedDate;
                                const event = getEventForDay(day);
                                const isWeekend = (i + startDay) % 7 === 0 || (i + startDay) % 7 === 6;
                                
                                return (
                                    <div 
                                        key={day} 
                                        onClick={() => setSelectedDate(day)}
                                        className={`
                                            aspect-square relative cursor-pointer border-2 transition-all group
                                            ${isSelected 
                                                ? 'bg-red-600 border-black text-white transform scale-110 z-10 shadow-[4px_4px_0px_black]' 
                                                : 'bg-white border-transparent hover:border-black hover:z-10'
                                            }
                                        `}
                                    >
                                        <div className={`absolute top-1 left-1 font-black italic text-lg leading-none ${isSelected ? 'text-white' : isWeekend ? 'text-red-600' : 'text-black'}`}>{day}</div>
                                        {event && (
                                            <div className={`absolute bottom-1 right-1`}>
                                                {event.type === 'deadline' ? <AlertTriangle size={12} className="text-red-500 fill-current" /> : <div className="w-2 h-2 bg-black rounded-full"></div>}
                                            </div>
                                        )}
                                        {isSelected && <div className="absolute -inset-1 border-2 border-black pointer-events-none transform -skew-x-6"></div>}
                                    </div>
                                );
                            })}
                        </div>

                        {/* Event Detail Card */}
                        <div className="relative mt-8">
                             {selectedEvent ? (
                                 <div className="bg-white border-4 border-black p-6 shadow-[8px_8px_0px_0px_#DC2626] transform rotate-1 animate-pop">
                                     <div className="absolute -top-4 -left-2 bg-black text-white px-3 py-1 font-black italic text-sm transform -skew-x-12 border-2 border-white shadow-md">
                                         {selectedEvent.type.toUpperCase()}
                                     </div>
                                     <div className="flex items-center gap-4">
                                         <div className="bg-gray-100 p-3 border-2 border-black rounded-full">
                                             <selectedEvent.icon size={32} />
                                         </div>
                                         <div>
                                             <h3 className="text-2xl font-black italic uppercase leading-none">{selectedEvent.title}</h3>
                                             <p className="text-xs font-bold text-gray-500 mt-1 uppercase tracking-widest">Target Confirmed</p>
                                         </div>
                                     </div>
                                     {selectedEvent.type === 'deadline' && (
                                         <div className="mt-4 bg-red-600 text-white p-2 text-center font-black italic border-2 border-black uppercase text-sm animate-pulse">
                                             Take Your Time
                                         </div>
                                     )}
                                 </div>
                             ) : (
                                 <div className="border-4 border-dashed border-gray-300 p-6 text-center">
                                     <h3 className="text-gray-400 font-black italic text-xl">NO EVENTS</h3>
                                     <p className="text-gray-400 text-xs font-bold">Mementos is quiet today.</p>
                                 </div>
                             )}
                        </div>
                    </div>
                </div>
            );
        };

        const GroupsListView = ({ router }) => {
            const [activeTab, setActiveTab] = useState("MY_GUILDS");
            
            return (
                <div className="pb-28 bg-gray-100 min-h-screen">
                    <P5Header title="Â≠¶‰π†Â∞èÁªÑ" subtitle="GUILDS" rightAction={<Plus size={28} onClick={() => router.push("CREATE_GROUP")} />} />
                    
                    {/* Tabs */}
                    <div className="flex border-b-4 border-black bg-white">
                        <button onClick={() => setActiveTab("MY_GUILDS")} className={`flex-1 py-3 font-black italic uppercase text-sm ${activeTab === 'MY_GUILDS' ? 'bg-red-600 text-white' : 'text-gray-400 hover:bg-gray-100'}`}>ÊàëÁöÑÁªÑÁªá</button>
                        <button onClick={() => setActiveTab("RECRUIT")} className={`flex-1 py-3 font-black italic uppercase text-sm ${activeTab === 'RECRUIT' ? 'bg-black text-white' : 'text-gray-400 hover:bg-gray-100'}`}>ÊãõÂãüÂ§ßÂéÖ</button>
                    </div>

                    <div className="px-5 mt-6 space-y-6">
                    {GROUPS.map(g => (
                        <div key={g.id} onClick={() => router.push("GROUP_DETAIL", { group: g })} className="relative cursor-pointer hover:translate-x-1 transition-transform group shadow-[6px_6px_0px_0px_black]">
                            <div className="bg-white border-2 border-black p-5 relative overflow-hidden">
                                {/* Header */}
                                <div className="flex justify-between items-start mb-2">
                                    <h2 className="text-2xl font-black italic uppercase">{g.title}</h2>
                                    <div className="bg-black text-white px-2 py-1 text-xs font-bold transform skew-x-12">{g.members}/{g.maxMembers}</div>
                                </div>
                                
                                {/* Tags */}
                                <div className="flex gap-2 mb-4">
                                    <span className="bg-yellow-400 text-black text-xs px-2 font-bold border border-black">{g.course}</span>
                                    {g.tags.map(tag => <span key={tag} className="bg-gray-200 text-gray-600 text-xs px-2 font-bold border border-transparent">{tag}</span>)}
                                </div>

                                {/* Progress Bar */}
                                <div className="mb-2">
                                    <div className="flex justify-between text-xs font-black italic mb-1">
                                        <span>MISSION PROGRESS</span>
                                        <span>{g.progress}%</span>
                                    </div>
                                    <div className="w-full h-3 bg-gray-200 border border-black skew-x-12 overflow-hidden">
                                        <div className="h-full bg-red-600" style={{width: `${g.progress}%`}}></div>
                                    </div>
                                </div>

                                <div className="bg-gray-50 p-2 border-l-4 border-black text-xs font-bold italic mt-2 truncate text-gray-500">
                                    LATEST: "{g.lastMsg}"
                                </div>
                            </div>
                        </div>
                    ))}
                    </div>
                </div>
            );
        };

        const GroupDetailView = ({ router }) => {
          const { group } = router.currentPage.params || { group: GROUPS[0] };
          
          return (
            <div className="bg-gray-100 min-h-screen animate-fade-in pb-28">
              <P5Header title={group.title} subtitle={group.course} onBack={router.pop} />
              
              {/* Notice Board */}
              <div className="bg-black text-white p-4 border-b-4 border-red-600 relative overflow-hidden">
                  <div className="absolute top-0 right-0 opacity-20 transform rotate-12"><AlertTriangle size={80} /></div>
                  <h3 className="text-red-500 font-black italic text-xl mb-1">PHANTOM NOTICE</h3>
                  <p className="font-bold text-sm italic">"{group.notice}"</p>
              </div>

              <div className="px-5 mt-6 space-y-6">
                  
                  {/* Members Strip */}
                  <div className="flex gap-2 overflow-x-auto pb-2">
                      <div className="w-12 h-12 bg-yellow-400 border-2 border-black rounded-full flex items-center justify-center shrink-0 font-black cursor-pointer hover:bg-white"><Plus /></div>
                      {["Joker", "Skull", "Fox"].map((m, i) => (
                          <div key={i} className="relative shrink-0">
                              <div className="w-12 h-12 bg-gray-300 border-2 border-black rounded-full overflow-hidden">
                                  <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${m}`} />
                              </div>
                              <div className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border border-black ${i===0 ? 'bg-green-500' : 'bg-gray-400'}`}></div>
                          </div>
                      ))}
                  </div>

                  {/* Kanban */}
                  <div className="bg-white border-2 border-black p-4 shadow-[4px_4px_0px_0px_black]">
                      <div className="flex justify-between items-center mb-3">
                          <h3 className="font-black italic text-xl">KANBAN</h3>
                          <button className="text-xs font-bold bg-black text-white px-2 py-1">ADD TASK</button>
                      </div>
                      {group.tasks.map(t => (
                          <div key={t.id} className="flex items-center gap-2 border-b py-2 last:border-0">
                              <div className={`w-4 h-4 border-2 border-black flex items-center justify-center ${t.status === 'done' ? 'bg-black' : 'bg-white'}`}>
                                  {t.status === 'done' && <Check size={12} className="text-white" />}
                              </div>
                              <span className={`flex-1 font-bold ${t.status === 'done' ? "line-through text-gray-400" : ""}`}>{t.title}</span>
                              <span className="text-[10px] font-black bg-gray-200 px-1">{t.assignee}</span>
                          </div>
                      ))}
                  </div>

                  {/* Ranking */}
                  <div className="bg-white border-2 border-black p-4 shadow-[4px_4px_0px_0px_#DC2626]">
                      <div className="flex items-center gap-2 mb-3">
                          <Trophy className="text-yellow-500" size={20} />
                          <h3 className="font-black italic text-xl">MVP RANKING</h3>
                      </div>
                      <div className="space-y-2">
                          {group.ranking.map((r, i) => (
                              <div key={i} className="flex items-center justify-between">
                                  <div className="flex items-center gap-2">
                                      <span className={`font-black italic w-4 ${i===0 ? 'text-red-600' : 'text-gray-400'}`}>{i+1}</span>
                                      <span className="font-bold">{r.name}</span>
                                      {i===0 && <Crown size={14} className="text-yellow-500 fill-current" />}
                                  </div>
                                  <span className="font-mono font-bold text-gray-500">{r.score} PT</span>
                              </div>
                          ))}
                      </div>
                  </div>

                  {/* Quick Actions Grid */}
                  <div className="grid grid-cols-2 gap-3">
                      <button className="p-3 border-2 border-black bg-white flex items-center justify-center gap-2 font-black hover:bg-gray-100">
                          <Folder size={18} /> STASH
                      </button>
                      <button className="p-3 border-2 border-black bg-white flex items-center justify-center gap-2 font-black hover:bg-gray-100">
                          <Calendar size={18} /> SCHEDULE
                      </button>
                  </div>

                  <P5Button className="w-full" onClick={() => router.push("CHAT_DETAIL", { chat: { name: group.title, avatar: "", id: "group_chat" } })}>
                      ËøõÂÖ•Âä†ÂØÜÁæ§ËÅä
                  </P5Button>
              </div>
            </div>
          );
        };

        const CreateGroupView = ({ router }) => (
          <div className="bg-white min-h-screen animate-fade-in pb-28">
            <P5Header title="Êñ∞Âª∫Â∞èÁªÑ" onBack={router.pop} />
            <div className="px-5 mt-8 space-y-6"><input className="w-full border-2 border-black p-4 font-bold transform -skew-x-6 outline-none focus:bg-yellow-50 focus:shadow-[4px_4px_0px_black] transition-all" placeholder="ËæìÂÖ•ÂêçÁß∞..." /><P5Button className="w-full py-4 text-xl mt-4" onClick={() => router.pop()}>ÊàêÁ´ãÂ•ëÁ∫¶</P5Button></div>
          </div>
        );

        const ChatDetailView = ({ router }) => {
            const { chat } = router.currentPage.params || { chat: CHATS[0] };
            const [inputValue, setInputValue] = useState("");
            const [messages, setMessages] = useState(MOCK_MESSAGES[chat.id] || []);
            const messagesEndRef = useRef(null);
            const [isTyping, setIsTyping] = useState(false);
          
            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(scrollToBottom, [messages, isTyping]);

            const handleSend = () => {
                if(!inputValue.trim()) return;
                const newMsg = { id: Date.now(), sender: "me", text: inputValue, time: "Now" };
                setMessages(prev => [...prev, newMsg]);
                setInputValue("");
                
                // Simulate P5 "Typing" effect
                setIsTyping(true);
                setTimeout(() => {
                    setIsTyping(false);
                    setMessages(prev => [...prev, { id: Date.now()+1, sender: "them", text: "Â∑≤Êî∂Âà∞ÔºÅ(Phantom Auto-Reply)", time: "Now" }]);
                }, 2000);
            }
          
            return (
              <div className="bg-slate-900 min-h-screen flex flex-col">
                <P5Header title={chat.name} subtitle="CHAT" onBack={router.pop} />
                
                {/* Chat Area - Red Theme */}
                <div className="flex-1 p-5 overflow-y-auto p5-chat-bg relative">
                   <div className="space-y-6 pb-4">
                       <div className="text-center"><span className="bg-black text-white px-3 py-1 text-xs font-black italic border border-white transform -skew-x-12 inline-block">TODAY</span></div>
                       
                       {messages.map((msg) => (
                           <div key={msg.id} className={`flex items-end gap-3 ${msg.sender === 'me' ? 'flex-row-reverse' : ''}`}>
                               {/* Avatar */}
                               {msg.sender === 'them' && (
                                   <div className="w-10 h-10 border-2 border-black bg-white shrink-0 overflow-hidden relative z-10">
                                       <img src={chat.avatar || "https://api.dicebear.com/7.x/avataaars/svg?seed=Group"} className="w-full h-full object-cover" />
                                   </div>
                               )}
                               
                               {/* Bubble */}
                               <div className={`relative max-w-[75%] group animate-pop`}>
                                   {/* Name Tag */}
                                   {msg.sender === 'them' && <div className="text-[10px] font-black text-black mb-1 ml-1 bg-white inline-block px-1 border border-black transform -skew-x-12">{chat.name}</div>}
                                   
                                   <div className={`
                                       p-3 font-bold text-sm border-2 border-black relative z-10
                                       ${msg.sender === 'me' 
                                            ? 'bg-black text-yellow-400 transform skew-x-6 shadow-[-4px_4px_0px_white]' 
                                            : 'bg-white text-black transform -skew-x-6 shadow-[4px_4px_0px_black]'}
                                   `}>
                                       {/* Inner Content to counteract skew */}
                                       <div className={msg.sender === 'me' ? 'transform -skew-x-6' : 'transform skew-x-6'}>
                                           {msg.text}
                                       </div>
                                   </div>
                                   <div className={`text-[10px] font-black mt-1 text-black opacity-60 ${msg.sender === 'me' ? 'text-right mr-1' : 'ml-1'}`}>{msg.time}</div>
                               </div>
                           </div>
                       ))}
                       
                       {isTyping && (
                           <div className="flex items-center gap-2 animate-pulse">
                               <div className="w-8 h-8 bg-black border border-white flex items-center justify-center transform rotate-12">
                                   <Loader2 size={16} className="text-yellow-400 animate-spin" />
                               </div>
                               <span className="text-white font-black italic text-xs bg-black px-2">TYPING...</span>
                           </div>
                       )}
                       <div ref={messagesEndRef} />
                   </div>
                </div>

                {/* Input Area */}
                <div className="p-4 bg-black border-t-4 border-white flex gap-2 items-center relative z-20">
                  <div className="absolute -top-6 left-4 bg-yellow-400 text-black px-2 font-black text-xs border-2 border-black transform -skew-x-12">PHANTOM MESSENGER</div>
                  <button className="bg-white text-black border-2 border-black p-2 hover:bg-gray-200 transition-colors"><Plus size={20} strokeWidth={3} /></button>
                  <input 
                    value={inputValue} 
                    onChange={(e) => setInputValue(e.target.value)} 
                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                    className="flex-1 bg-gray-900 text-white border-2 border-gray-600 px-4 py-3 font-bold outline-none focus:border-yellow-400 focus:bg-black transition-colors transform -skew-x-6" 
                    placeholder="Take your heart..." 
                  />
                  <button onClick={handleSend} className="bg-red-600 text-white px-6 py-3 font-black italic border-2 border-white hover:bg-white hover:text-red-600 transition-colors transform skew-x-6 shadow-[2px_2px_0px_white] active:translate-y-1 active:shadow-none">
                      <div className="transform -skew-x-6">SEND</div>
                  </button>
                </div>
              </div>
            );
        };
        
        const MessageListView = ({ router }) => (
            <div className="bg-white min-h-screen animate-fade-in pb-28">
              <P5Header title="Ê∂àÊÅØ" subtitle="MESSAGES" onBack={router.pop} />
              <div className="p-0">
                {CHATS.map((chat, i) => (
                  <div key={chat.id} onClick={() => router.push("CHAT_DETAIL", { chat })} className="p-5 border-b-2 border-black flex gap-4 hover:bg-blue-600 hover:text-white group cursor-pointer transition-colors">
                    <div className="relative"><img src={chat.avatar} className="w-14 h-14 border-2 border-black grayscale group-hover:grayscale-0" />{chat.unread > 0 && <div className="absolute -top-1 -right-1 w-5 h-5 bg-blue-600 group-hover:bg-white group-hover:text-blue-600 text-white flex items-center justify-center font-bold text-xs border border-black rounded-full">{chat.unread}</div>}</div>
                    <div className="flex-1"><div className="flex justify-between items-baseline mb-1"><h4 className="text-2xl font-black italic uppercase">{chat.name}</h4><span className="text-xs font-bold opacity-60">{chat.time}</span></div><p className="font-bold text-sm opacity-80 line-clamp-1">"{chat.lastMsg}"</p></div>
                  </div>
                ))}
              </div>
            </div>
        );

        // --- Profile View ---
        const ProfileView = ({ router }) => (
          <div className="pb-28 bg-white min-h-screen">
            <div className="bg-black text-white pt-12 pb-8 px-6 relative overflow-hidden">
              <div className="absolute top-0 right-0 w-full h-full border-t-[100px] border-l-[400px] border-t-blue-600 border-l-transparent opacity-50"></div>
              <div className="relative z-10 flex items-center gap-6"><img src={CURRENT_USER.avatar} className="w-20 h-20 border-4 border-white grayscale contrast-125 bg-gray-200" /><div><h2 className="text-3xl font-black italic uppercase">{CURRENT_USER.name}</h2><span className="bg-yellow-400 text-black px-2 font-black text-sm border border-black italic">LV. 15 SCHOLAR</span></div></div>
              <div className="flex gap-4 relative z-10 mt-8">{[{ l: "‰∏ìÊ≥®/ÂàÜ", v: "1240" }, { l: "ÂÆåÊàê‰ªªÂä°", v: "15" }, { l: "‰ø°Ë™âÂàÜ", v: "98" }].map((s, i) => (<div key={i} className="flex-1 bg-white text-black p-3 border-b-4 border-blue-600 text-center shadow-[4px_4px_0px_0px_black]"><div className="text-2xl font-black italic">{s.v}</div><div className="text-[10px] font-bold bg-black text-white px-1 uppercase tracking-widest">{s.l}</div></div>))}</div>
            </div>
            <div className="p-5 grid grid-cols-2 gap-4">
              {[{ l: "ÊàëÁöÑËØæË°®", i: Clock, p: "SCHEDULE", c: "bg-gray-50" }, { l: "ÊàêÂ∞±ÂããÁ´†", i: Star, p: "GOALS", c: "bg-yellow-400" }, { l: "ÁæÅÁªäÁÉ≠Âõæ", i: Heart, p: "CONFIDANTS", c: "bg-red-600 text-white" }, { l: "ÂÅèÂ•ΩËÆæÁΩÆ", i: Settings, p: "SETTINGS", c: "bg-gray-50" }].map((item, i) => (
                <button key={i} onClick={() => item.p && router.push(item.p)} className={`${item.c} p-6 border-2 border-black hover:bg-blue-600 hover:text-white transition-all group text-left relative shadow-[4px_4px_0px_0px_black] active:translate-x-1 active:translate-y-1 active:shadow-none`}>
                  <item.i size={32} strokeWidth={2} className="mb-2 group-hover:scale-110 transition-transform" /><div className="font-black text-lg italic uppercase">{item.l}</div><ArrowRight size={20} className="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity" />
                </button>
              ))}
            </div>
          </div>
        );

        // --- Settings View ---
        const SettingItem = ({ label, active, onClick }) => (<div onClick={onClick} className="bg-white border-2 border-black p-4 flex justify-between items-center shadow-[4px_4px_0px_black] cursor-pointer group active:translate-y-1 active:shadow-none transition-all"><span className="font-black italic uppercase group-hover:text-blue-600 transition-colors">{label}</span><div className={`w-12 h-6 border-2 border-black flex items-center px-1 transition-colors ${active ? 'bg-yellow-400 justify-end' : 'bg-gray-200 justify-start'}`}><div className="w-4 h-4 bg-black transform rotate-45"></div></div></div>);
        const SettingsView = ({ router }) => {
            const [settings, setSettings] = useState({ sound: true, notifications: true, animations: true, privacy: false });
            const toggle = (key) => setSettings(p => ({ ...p, [key]: !p[key] }));
            return (
                <div className="bg-gray-100 min-h-screen animate-fade-in pb-28">
                <P5Header title="Á≥ªÁªüËÆæÁΩÆ" subtitle="CONFIG" onBack={router.pop} />
                <div className="px-5 mt-6 space-y-8">
                    <div><h3 className="text-xl font-black italic bg-black text-white px-2 inline-block transform -skew-x-12 mb-4">AUDIO & VISUAL</h3><div className="space-y-3"><SettingItem label="Phantom Sound (Èü≥Êïà)" active={settings.sound} onClick={() => toggle('sound')} /><SettingItem label="Calling Card (ÈÄöÁü•)" active={settings.notifications} onClick={() => toggle('notifications')} /><SettingItem label="Motion Sickness (Âä®Áîª)" active={settings.animations} onClick={() => toggle('animations')} /></div></div>
                    <div><h3 className="text-xl font-black italic bg-black text-white px-2 inline-block transform -skew-x-12 mb-4">COGNITION</h3><div className="space-y-3"><SettingItem label="Incognito Mode (ÈöêË∫´)" active={settings.privacy} onClick={() => toggle('privacy')} /></div></div>
                    <div><h3 className="text-xl font-black italic bg-black text-white px-2 inline-block transform -skew-x-12 mb-4">METAVERSE</h3><div className="space-y-3"><div className="bg-white border-2 border-black p-4 flex justify-between items-center shadow-[4px_4px_0px_black] active:translate-y-1 active:shadow-none transition-all cursor-pointer"><span className="font-black italic uppercase">Version Info</span><span className="font-bold text-xs bg-yellow-400 px-1 border border-black">v5.0 R</span></div><div className="bg-red-600 text-white border-2 border-black p-4 flex justify-between items-center shadow-[4px_4px_0px_black] active:translate-y-1 active:shadow-none transition-all cursor-pointer"><span className="font-black italic uppercase">Log Out</span><LogOut size={20} /></div></div></div>
                </div></div>
            );
        };

        const FocusView = ({ router }) => {
          const [timeLeft, setTimeLeft] = useState(1500);
          const [active, setActive] = useState(false);
          const [musicPlaying, setMusicPlaying] = useState(false);
          const [currentTrack, setCurrentTrack] = useState(0);

          useEffect(() => { 
              if(active && timeLeft > 0) { 
                  const t = setInterval(() => setTimeLeft(l => l - 1), 1000); 
                  return () => clearInterval(t); 
              } 
          }, [active, timeLeft]);

          const toggleMusic = () => setMusicPlaying(!musicPlaying);
          const nextTrack = () => setCurrentTrack((currentTrack + 1) % MUSIC_TRACKS.length);

          return (
            <div className="h-screen bg-blue-600 flex flex-col items-center justify-center p-6 text-white overflow-hidden relative">
              <div className="absolute inset-0 flex items-center justify-center opacity-30"><StarBurst className="w-[600px] h-[600px] animate-spin-slow" /></div>
              <button onClick={router.pop} className="absolute top-6 left-6 z-50 bg-black p-2 border-2 border-white hover:bg-white hover:text-black transition-colors"><X /></button>
              
              <div className="relative z-10 w-full max-w-sm">
                  <div className="bg-black p-8 border-4 border-white transform rotate-1 shadow-[10px_10px_0px_0px_white] text-center mb-8">
                    <h2 className="text-4xl font-black italic mb-6 tracking-widest">MISSION START</h2>
                    <div className="text-7xl font-black font-mono bg-white text-blue-600 p-2 border-2 border-black mb-8 shadow-inner">{Math.floor(timeLeft/60).toString().padStart(2,'0')}:{Math.floor(timeLeft%60).toString().padStart(2,'0')}</div>
                    <button onClick={() => setActive(!active)} className="w-20 h-20 bg-yellow-400 text-black border-4 border-black flex items-center justify-center mx-auto rounded-none transform rotate-45 transition-transform active:scale-95 hover:bg-white"><div className="transform -rotate-45">{active ? <Pause size={32} fill="black" /> : <Play size={32} fill="black" />}</div></button>
                  </div>

                  {/* Music Player Widget */}
                  <div className="bg-white border-4 border-black p-4 transform -rotate-2 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.5)]">
                     <div className="flex items-center gap-3 mb-2">
                        <div className={`p-2 bg-black text-white ${musicPlaying ? 'animate-pulse' : ''}`}><Music size={20} /></div>
                        <div className="flex-1 overflow-hidden">
                             <div className="text-black font-black italic uppercase whitespace-nowrap text-sm">{MUSIC_TRACKS[currentTrack].title}</div>
                             <div className="text-gray-500 text-xs font-bold uppercase">{MUSIC_TRACKS[currentTrack].artist}</div>
                        </div>
                     </div>
                     <div className="flex justify-between items-center border-t-2 border-black pt-2">
                         <button onClick={toggleMusic} className="hover:text-blue-600 font-bold text-xs">{musicPlaying ? "PAUSE" : "PLAY RADIO"}</button>
                         <div className="flex gap-2">
                             <button onClick={nextTrack} className="hover:scale-110"><SkipForward size={20} fill="black" /></button>
                         </div>
                     </div>
                  </div>
              </div>
            </div>
          );
        };

        const CountdownView = ({ router }) => (
          <div className="bg-white min-h-screen animate-fade-in pb-28">
            <P5Header title="ÂÄíÊï∞Êó•" subtitle="DEADLINE" onBack={router.pop} rightAction={<Plus size={24} />} />
            <div className="px-5 mt-6 space-y-6">
              {[{t:"Ëã±ËØ≠ÂÖ≠Á∫ß", d:45, c:"bg-blue-600"}, {t:"ÊúüÊú´ËÄÉËØï", d:72, c:"bg-yellow-400"}].map((it, i) => (
                <div key={i} className={`p-4 border-2 border-black transform shadow-[6px_6px_0px_black] ${it.c}`}>
                  <h3 className="font-black text-2xl italic uppercase text-white" style={{textShadow:"2px 2px 0 black"}}>{it.t}</h3>
                  <div className="text-right text-white"><span className="text-6xl font-black font-mono">{it.d}</span> <span className="font-black italic uppercase">Days</span></div>
                </div>
              ))}
            </div>
          </div>
        );
        
        const GoalsView = ({ router }) => {
          const [goals, setGoals] = useState([{ title: "ÈòÖËØª50Êú¨‰π¶", progress: 12, total: 50, color: "bg-blue-600" }]);
          const [showAi, setShowAi] = useState(false);
          const [input, setInput] = useState("");
          const [loading, setLoading] = useState(false);
        
          const handleGen = async () => {
            setLoading(true);
            await callGemini(`‰∏∫${input}ÁîüÊàê‰ªªÂä°`);
            setGoals([{title: input, progress: 0, total: 100, color: "bg-yellow-400"}, ...goals]);
            setLoading(false); setShowAi(false);
          };
        
          return (
            <div className="bg-white min-h-screen animate-fade-in relative">
              <P5Header title="ÁõÆÊ†áÊåëÊàò" onBack={router.pop} rightAction={<Sparkles size={24} onClick={()=>setShowAi(true)} />} />
              <div className="px-5 mt-6 space-y-4">
                {goals.map((g, i) => (
                  <div key={i} className="border-4 border-black p-4 shadow-[6px_6px_0px_black]">
                    <div className="flex justify-between items-end mb-2"><h4 className="font-black italic">{g.title}</h4><span>{g.progress}%</span></div>
                    <div className="h-4 border-2 border-black bg-white overflow-hidden"><div className={`h-full ${g.color}`} style={{width:`${(g.progress/g.total)*100}%`}}></div></div>
                  </div>
                ))}
              </div>
              {showAi && (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-5">
                  <div className="bg-white border-4 border-blue-600 p-6 w-full max-w-sm">
                    <h3 className="font-black text-xl mb-4 italic uppercase">AI ÁõÆÊ†áÁîüÊàê</h3>
                    <input value={input} onChange={e=>setInput(e.target.value)} className="w-full border-2 border-black p-3 mb-4 font-bold" placeholder="ËæìÂÖ•Â≠¶‰π†ÁõÆÊ†á..." />
                    <P5Button className="w-full" onClick={handleGen} disabled={loading}>{loading ? "AI ËÆ°ÁÆó‰∏≠..." : "ÁîüÊàêÂ•ëÁ∫¶"}</P5Button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const FlashcardsView = ({ router }) => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const currentCard = FLASHCARDS_DATA[currentIndex];

            const nextCard = () => {
                setIsFlipped(false);
                setTimeout(() => setCurrentIndex((prev) => (prev + 1) % FLASHCARDS_DATA.length), 200);
            };

            return (
                <div className="bg-slate-900 min-h-screen flex flex-col pb-28">
                    <P5Header title="ËÆ∞ÂøÜÂÆ´ÊÆø" subtitle="COGNITION" onBack={router.pop} />
                    
                    <div className="flex-1 px-6 py-8 flex flex-col items-center justify-center perspective-1000">
                        {/* Progress */}
                        <div className="w-full mb-6 flex justify-between text-gray-400 font-bold italic">
                            <span>CARD {currentIndex + 1}</span>
                            <span>TOTAL {FLASHCARDS_DATA.length}</span>
                        </div>

                        {/* Card Container */}
                        <div 
                            className="relative w-full aspect-[4/5] cursor-pointer group"
                            onClick={() => setIsFlipped(!isFlipped)}
                        >
                            <div className={`w-full h-full transition-all duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                                {/* Front */}
                                <div className="absolute inset-0 backface-hidden bg-white border-4 border-black p-8 flex flex-col items-center justify-center text-center shadow-[8px_8px_0px_0px_#2563EB]">
                                    <div className="absolute top-4 left-4 text-4xl font-black text-gray-100 italic">Q</div>
                                    <h3 className="text-2xl font-black text-slate-900 leading-snug">{currentCard.question}</h3>
                                    <div className="absolute bottom-4 text-xs font-bold text-gray-400 uppercase tracking-widest animate-pulse">Tap to Reveal</div>
                                </div>
                                
                                {/* Back */}
                                <div className="absolute inset-0 backface-hidden rotate-y-180 bg-black border-4 border-yellow-400 p-8 flex flex-col items-center justify-center text-center shadow-[8px_8px_0px_0px_white]">
                                    <div className="absolute top-4 left-4 text-4xl font-black text-gray-800 italic">A</div>
                                    <p className="text-xl font-bold text-white leading-relaxed">{currentCard.answer}</p>
                                </div>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="w-full grid grid-cols-2 gap-4 mt-8">
                             <P5Button variant="danger" onClick={nextCard}>Ê®°Á≥ä</P5Button>
                             <P5Button variant="accent" onClick={nextCard}>ËÆ∞‰Ωè</P5Button>
                        </div>
                    </div>
                </div>
            );
        };

        const ConfidantMapView = ({ router }) => {
            const sortedBuddies = [...BUDDY_RECOMMENDATIONS, ...CHATS].sort((a,b) => (b.rank || 0) - (a.rank || 0));
            // Remove duplicates based on name for this demo
            const uniqueBuddies = Array.from(new Map(sortedBuddies.map(item => [item.name, item])).values());

            return (
                <div className="bg-red-600 min-h-screen pb-28">
                    <P5Header title="ÁæÅÁªäÁÉ≠Âõæ" subtitle="SOCIAL LINKS" onBack={router.pop} />
                    <div className="px-5 mt-6 space-y-6">
                        {uniqueBuddies.map((buddy, index) => (
                            <div key={index} className="bg-black p-4 border-l-8 border-white shadow-[6px_6px_0px_0px_rgba(0,0,0,0.3)] relative overflow-hidden group hover:bg-slate-900 transition-colors cursor-pointer" onClick={() => router.push("BUDDY_DETAIL", { buddy })}>
                                {/* Background Arcana Text */}
                                <div className="absolute -right-4 -bottom-4 text-6xl font-black text-gray-800 italic opacity-50 z-0">{buddy.arcana || "UNKNOWN"}</div>
                                
                                <div className="relative z-10 flex gap-4 items-center">
                                    <img src={buddy.avatar} className="w-16 h-16 border-2 border-white" />
                                    <div className="flex-1">
                                        <div className="flex justify-between items-baseline">
                                            <h3 className="text-2xl font-black italic text-white uppercase">{buddy.name}</h3>
                                            <span className="text-yellow-400 font-bold text-sm italic">Rank {buddy.rank || 1}</span>
                                        </div>
                                        <div className="mt-2 flex gap-1">
                                            {Array.from({length: 10}).map((_, i) => (
                                                <div key={i} className={`h-2 flex-1 transform -skew-x-12 ${i < (buddy.rank || 1) ? 'bg-blue-500' : 'bg-gray-700'}`}></div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                         <div className="text-center p-4">
                            <p className="text-white text-xs font-bold italic opacity-80">Âª∫Á´ãÊõ¥Ê∑±ÁöÑÁæÅÁªä‰ª•Ëß£ÈîÅÊñ∞ÁöÑÂçèÂä©ËÉΩÂäõ</p>
                        </div>
                    </div>
                </div>
            );
        };

        const SeatsView = ({ router }) => (
          <div className="bg-white min-h-screen animate-fade-in pb-28">
            <P5Header title="Âç†Â∫ßÁÉ≠Âäõ" onBack={router.pop} />
            <div className="px-5 mt-6">
              <div className="grid grid-cols-4 gap-3 border-4 border-black p-4 bg-gray-50 shadow-[8px_8px_0px_black]">{Array.from({length:16}).map((_, i) => <div key={i} className={`aspect-square border-2 border-black flex items-center justify-center font-black ${[1,3,10].includes(i) ? "bg-gray-300" : "bg-white hover:bg-yellow-100"}`}>{[1,3,10].includes(i) ? "X" : i+1}</div>)}</div>
              <p className="mt-4 text-xs font-bold italic uppercase opacity-60">* Â∑≤Êé•ÂÖ•Âõæ‰π¶È¶ÜÂÆûÊó∂ API Êï∞ÊçÆ</p>
            </div>
          </div>
        );

        const FilesView = ({ router }) => (
          <div className="bg-white min-h-screen animate-fade-in pb-28">
            <P5Header title="ÂÖ±‰∫´ËµÑÊñô" subtitle="DATA" onBack={router.pop} />
            <div className="px-5 mt-6 space-y-4">
              {FILES.map(f => (
                <div key={f.id} className="bg-white border-2 border-black p-4 flex justify-between items-center shadow-[4px_4px_0px_black]">
                  <div><h4 className="font-black italic uppercase leading-none">{f.name}</h4><span className="text-[10px] font-bold opacity-50">{f.size}</span></div>
                  <Download size={20} className="hover:text-blue-600 cursor-pointer" />
                </div>
              ))}
            </div>
          </div>
        );

        const NotificationsView = ({ router }) => (
          <div className="bg-white min-h-screen animate-fade-in pb-28">
            <P5Header title="ÈÄöÁü•‰∏≠ÂøÉ" onBack={router.pop} />
            <div className="px-5 mt-6 space-y-4">
              {NOTIFICATIONS.map(n => (
                <div key={n.id} className="border-2 border-black p-4 bg-gray-50 shadow-[4px_4px_0px_black] animate-pop">
                  <div className="flex justify-between text-[10px] font-black uppercase mb-1"><span>{n.type}</span><span className="opacity-40">{n.time}</span></div>
                  <h5 className="font-black text-blue-600">{n.title}</h5>
                  <p className="text-sm font-bold opacity-80">{n.content}</p>
                </div>
              ))}
            </div>
          </div>
        );

        const ScheduleView = ({ router }) => (
          <div className="bg-gray-100 min-h-screen animate-fade-in pb-28">
            <P5Header title="ÊàëÁöÑËØæË°®" onBack={router.pop} />
            <div className="px-5 mt-4 space-y-4">
              {COURSES.map(c => (
                <div key={c.id} className={`p-4 border-2 border-black ${c.theme} shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)]`}>
                  <div className="text-xs font-black uppercase opacity-60 mb-1">{c.day} | {c.time}</div>
                  <h4 className="text-xl font-black italic">{c.name}</h4>
                  <div className="text-xs font-bold mt-2"><MapIcon size={12} className="inline mr-1" />{c.location}</div>
                </div>
              ))}
            </div>
          </div>
        );

        const CourseDetailView = ({ router }) => {
          const { course } = router.currentPage.params || { course: COURSES[0] };
          return (
            <div className="bg-white min-h-screen animate-fade-in">
              <div className={`h-48 ${course.theme} border-b-4 border-black relative flex items-end p-6 overflow-hidden`}><button onClick={router.pop} className="absolute top-4 left-4 bg-white text-black p-1 border-2 border-black z-20"><ChevronLeft /></button><h2 className="text-4xl font-black italic uppercase relative z-10 leading-none" style={{textShadow:"3px 3px 0 black"}}>{course.name}</h2></div>
              <div className="p-6"><P5Button className="w-full mb-4" onClick={() => router.push("MATCH")}>ÂåπÈÖçÂêåÂ≠¶ÈòüÂèã</P5Button></div>
            </div>
          );
        };

        const BuddyDetailView = ({ router }) => {
          const { buddy } = router.currentPage.params || { buddy: BUDDY_RECOMMENDATIONS[0] };
          return (
            <div className="bg-white min-h-screen animate-fade-in">
              <div className="h-40 bg-black relative"><button onClick={router.pop} className="absolute top-4 left-4 text-white"><ChevronLeft size={32} /></button></div>
              <div className="px-5 -mt-12 relative z-10"><img src={buddy.avatar} className="w-32 h-32 border-4 border-white bg-black shadow-lg" /><h1 className="text-4xl font-black italic uppercase mt-4">{buddy.name}</h1><p className="bg-gray-100 p-6 border-2 border-black italic font-bold">"{buddy.desc}"</p><P5Button className="w-full mt-8" onClick={() => router.push("CHAT_DETAIL", { chat: { name: buddy.name, avatar: buddy.avatar, id: buddy.id } })}>ÂèëÈÄÅ‰ΩúÊàòÈÇÄËØ∑</P5Button></div>
            </div>
          );
        };

        // --- Main App ---
        const App = () => {
          const router = useRouter("HOME");
          const handleSwitchTab = (id) => { if (id === "FOCUS") router.push("FOCUS"); else router.reset(id); };
        
          const renderPage = () => {
            const { name } = router.currentPage;
            const pageMap = {
              HOME: <HomeView router={router} />, MATCH: <MatchView router={router} />,
              GROUPS: <GroupsListView router={router} />, PROFILE: <ProfileView router={router} />,
              FOCUS: <FocusView router={router} />, COUNTDOWN: <CountdownView router={router} />,
              GOALS: <GoalsView router={router} />, SEATS: <SeatsView router={router} />,
              FILES: <FilesView router={router} />, NOTIFICATIONS: <NotificationsView router={router} />,
              SCHEDULE: <ScheduleView router={router} />, COURSE_DETAIL: <CourseDetailView router={router} />,
              BUDDY_DETAIL: <BuddyDetailView router={router} />, GROUP_DETAIL: <GroupDetailView router={router} />,
              CREATE_GROUP: <CreateGroupView router={router} />, CHAT_DETAIL: <ChatDetailView router={router} />,
              MESSAGES: <MessageListView router={router} />,
              FLASHCARDS: <FlashcardsView router={router} />, 
              CONFIDANTS: <ConfidantMapView router={router} />,
              SETTINGS: <SettingsView router={router} />,
              CALENDAR: <CalendarView router={router} />,
              BUDDY_SQUARE: <BuddySquareView router={router} />,
              REQUESTS: <RequestBoardView router={router} />,
              PACTS: <StudyPactView router={router} />,
              CLOUD_ROOM: <CloudRoomView router={router} />,
              MARKET: <MarketView router={router} />,
              DUEL: <DuelView router={router} />,
              CHECKIN: <CheckinView router={router} />,
              PERSONA_TEST: <PersonaTestView router={router} />,
              RADAR: <RadarView router={router} />,
              BOTTLE: <BottleView router={router} />,
              SAFE_HOUSE: <SafeHouseView router={router} />, 
              RUMORS: <RumorsView router={router} /> 
            };
            return pageMap[name] || <HomeView router={router} />;
          };
        
          return (
            <div className="font-sans bg-slate-900 h-screen flex justify-center selection:bg-blue-600 selection:text-white">
              <div className="w-full max-w-md bg-white h-full shadow-2xl relative overflow-hidden flex flex-col border-x-4 border-black">
                <div className="flex-1 overflow-y-auto hide-scrollbar scroll-smooth">{renderPage()}</div>
                {["HOME", "MATCH", "GROUPS", "PROFILE"].includes(router.currentPage.name) && (
                  <P5TabBar activeTab={router.currentPage.name} onSwitchTab={handleSwitchTab} />
                )}
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
